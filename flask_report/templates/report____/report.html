{% extends "report____/layout.html" %}

{% block report____title_block %}
  {{ report.name }}
{% endblock %}

{% block report____customized_head_block %}
<link rel="stylesheet" type="text/css" href="{{ url_for('report____.static', filename='datatables/css/jquery.dataTables.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('report____.static', filename='css/customer.css') }}">
<script type="text/javascript" charset="utf8" src="{{ url_for('report____.static', filename='datatables/js/jquery.dataTables.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('report____.static', filename='js/DT_bootstrap.js') }}"></script>
<script type="text/javascript">
  $.extend( $.fn.dataTableExt.oStdClasses, {
      "sWrapper": "dataTables_wrapper form-inline"
  });
  $(function () {
      var oTable = $("#report").dataTable({
        "oLanguage": {
            "sSearch": '{{ _("Search") }}' + " :",
            "sLengthMenu": '{{ _("Display _MENU_ records per page") }}',
            "sZeroRecords": '{{ _("Nothing found - sorry") }}',
            "sInfo": '{{ _("Showing _START_ to _END_ of _TOTAL_ records") }}',
            "sInfoEmpty": '{{ _("Showing 0 to 0 of 0 records") }}',
            "sInfoFiltered": "(" + '{{ _("filtered from _MAX_ total records") }}' + ")",
            'oPaginate': {
              "sPrevious": '{{ _("Previous") }} ',
              "sNext": '{{ _("Next") }}',
              "sFirst": '{{ _("First") }}',
              'sLast': '{{ _("Last") }}',
              },
            },
        "bSortCellsTop": true,
        "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
        "iDisplayLength": 25,
        });
      $("#detail").on('shown', function () {
        $('a[data-target="#detail"]').text("{{ _('hide detail') }}" + " <<");
        });
      $("#detail").on('hidden', function () {
        $('a[data-target="#detail"]').text("{{ _('show detail') }}" + " >>");
        });

	
      /* Add the events etc before DataTables hides a column */
      $("thead input").keyup( function () {
          /* Filter on the column (the index) of this element */
          oTable.fnFilter( this.value, oTable.oApi._fnVisibleToColumnIndex( 
              oTable.fnSettings(), $("thead input").index(this) ) );
          });
	
      /*
       * Support functions to provide a little bit of 'user friendlyness' to the textboxes
       */
      $("thead input").each( function (i) {
        this.initVal = this.value;
      });
	
      $("thead input").focus( function () {
        if ( this.className == "search_init" )
        {
          this.className = "";
          this.value = "";
        }
      });
	
      $("thead input").blur( function (i) {
        if ( this.value == "" )
        {
          this.className = "search_init";
          this.value = this.initVal;
        }
        });

      $('#report a[data-role="drill-down-link"]').click(
          function () {
            var modal = $('#drill-down-detail');
            modal.find('.modal-header h3').text(sprintf('{{ _("detail of %%s") }}', $(this).attr('data-col')));
            modal.modal('show');
            var content = modal.find('.modal-body p')
            content.html('<i class="icon-refresh icon-spin icon-4x"></i>');
            content.load($(this).attr('data-target'));
          });	
  });
</script>
{% endblock %}

{% block body %}
<div class="">
<div class="alert alert-info">
  <h1>
  <span>
    {{report.name}}
    <small>
      <a href="#" data-toggle="collapse" data-target="#detail" class='muted'>{{ _('show detail') }} >></a>
    </small>
  </span>
  </h1>
  <div id="detail" class="collapse">
  <p><small>{{ report.description +"<br>"|safe if report.description else "" }}{{ _('created by "%(creator)s" at %(create_time)s, using data set <span title="%(data_set_description)s">"%(data_set)s"</span>, ',
    creator=report.creator, create_time=report.creat_time,
    data_set_description=report.data_set.description,
    data_set=report.data_set.name) }}
    {% if report.order_by %}
      {{ _('order by "%(order_by)s" %(order)s',
        order_by=report.order_by.name, 
        order=_('descendingly') if report.order_by.descend else _('ascendingly'))
      }}
    {% endif %}; 
    {{ _('filter conditions are: ') }}
  </small></p>
  <ul>
    {% if report.filters %}
    {% for name, value in report.filters.items() %}
    <li>
    <small>
      <Strong>{{ name }}</Strong> - {{ value|dpprint }}
    </small>
    </li>
    {% endfor %}
    {% endif %}
  </ul>
  <p>
    <small>
      {{ _("the customized filter condition is: ") }}
    </small>
  </p>
  <p>
    {{ customized_filter_condition|safe }}
  </p>
  <p><small></small></p>
</div>
</div>
<hr />
<div>
{{ html_report|safe }}
</div>
<hr />

<span class='span-12'>
  {{ _("download as: ")}}
  <div class="btn-group pagination-centered">
    <a href="{{ url_for('.report_pdf', id_=report.id_) }}" class="btn btn-primary btn-info">PDF</a>
    <a href="{{ url_for('.report_csv', id_=report.id_) }}" class="btn btn-primary btn-info">CSV</a>
{#    <a href="{{ url_for('.report_txt', id_=report.id_) }}" class="btn btn-primary btn-info">TXT</a>#}
  </div>
</span>
<div class="pagination-centered span12">
  <a href="{{ url_for('.report_list') }}" class="btn btn-primary btn-large">{{ _('BACK') }}</a>
  <a href="" class="btn btn-primary btn-large">{{ _('EDIT') }}</a>
  <a href="" class="btn btn-primary btn-large">{{ _('REFRESH') }}</a>
</div>
</div>

<div id="drill-down-detail" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <h3></h3>
  </div>
  <div class="modal-body">
    <p class="pagination-centered">
    </p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">{{ _('Close') }}</button>
  </div>
</div>
{% endblock %}
